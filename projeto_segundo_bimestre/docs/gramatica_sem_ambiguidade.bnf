# ============================================================
# GRAMÁTICA VYTHON 
# Versão: LL(1) Completa
# ============================================================

# -------------------- PROGRAMA --------------------
<program> ::= <statement_list>

<statement_list> ::= <statement> <statement_list>
                   | ε


# -------------------- STATEMENTS --------------------
<statement> ::= <ifStatement>
              | <whileStatement>
              | <forStatement>
              | <doWhileStatement>
              | <breakStatement>
              | <continueStatement>
              | <defStatement>
              | <expressionStatement>

<expressionStatement> ::= <expression> <optional_semicolon>

<optional_semicolon> ::= ';'
                       | ε


# -------------------- CONTROLE DE FLUXO --------------------
<ifStatement> ::= 'if' <expression> ':' <block> <optional_else>

<optional_else> ::= 'else' ':' <block>
                  | ε

<whileStatement> ::= 'while' <expression> ':' <block>

<forStatement> ::= 'for' IDENTIFIER 'in' 'range' '(' <expression> <range_params> ')' ':' <block>

<range_params> ::= ',' <expression> <optional_third>
                 | ε

<optional_third> ::= ',' <expression>
                   | ε

<doWhileStatement> ::= 'do' ':' <block> 'while' <expression> <optional_semicolon>

<breakStatement> ::= 'break' <optional_semicolon>

<continueStatement> ::= 'continue' <optional_semicolon>


# -------------------- FUNÇÕES --------------------
<defStatement> ::= 'def' IDENTIFIER '(' <param_list> ')' ':' '{' <statement_list> '}' <optional_semicolon>

<param_list> ::= IDENTIFIER <param_rest>
               | ε

<param_rest> ::= ',' IDENTIFIER <param_rest>
               | ε


# -------------------- BLOCOS --------------------
<block> ::= '{' <statement_list> '}'
          | <statement>


# ============================================================
# EXPRESSÕES - HIERARQUIA REFATORADA 
# ============================================================

<expression> ::= <assignmentExpr>


# -------------------- Nível 0: Assignment --------------------
<assignmentExpr> ::= <logicalOrExpr> <assign_rest>

<assign_rest> ::= '=' <assignmentExpr>
                | ε


# -------------------- Nível 1: OR Lógico --------------------
<logicalOrExpr> ::= <logicalAndExpr> <or_tail>

<or_tail> ::= 'or' <logicalAndExpr> <or_tail>
            | ε


# -------------------- Nível 2: AND Lógico --------------------
<logicalAndExpr> ::= <logicalNotExpr> <and_tail>

<and_tail> ::= 'and' <logicalNotExpr> <and_tail>
             | ε


# -------------------- Nível 3: NOT Lógico (unário) --------------------
<logicalNotExpr> ::= 'not' <logicalNotExpr>
                   | <bitwiseOrExpr>


# -------------------- Nível 4: OR Bitwise --------------------
<bitwiseOrExpr> ::= <bitwiseAndExpr> <bitor_tail>

<bitor_tail> ::= '|' <bitwiseAndExpr> <bitor_tail>
               | ε


# -------------------- Nível 5: AND Bitwise --------------------
<bitwiseAndExpr> ::= <comparisonExpr> <bitand_tail>

<bitand_tail> ::= '&' <bitwiseAndExpr> <bitand_tail>
                | ε


# -------------------- Nível 6: Comparação --------------------
<comparisonExpr> ::= <additiveExpr> <comparison_rest>

<comparison_rest> ::= <comparison_op> <additiveExpr>
                    | ε

<comparison_op> ::= '=='
                  | '!='
                  | '<='
                  | '>='
                  | '<'
                  | '>'


# ============================================================
# MUDANÇA CRÍTICA: - UNÁRIO SEPARADO
# ============================================================

# -------------------- Nível 7: Adição/Subtração --------------------
# AGORA: - binário está AQUI (trabalha com <multiplicativeExpr>)
<additiveExpr> ::= <multiplicativeExpr> <additive_tail>

<additive_tail> ::= '+' <multiplicativeExpr> <additive_tail>
                  | '-' <multiplicativeExpr> <additive_tail>
                  | ε


# -------------------- Nível 8: Multiplicação --------------------
# MUDANÇA: Agora trabalha com <powerExpr>, não com <unaryExpr>
<multiplicativeExpr> ::= <powerExpr> <multiplicative_tail>

<multiplicative_tail> ::= '*' <powerExpr> <multiplicative_tail>
                        | '/' <powerExpr> <multiplicative_tail>
                        | '%' <powerExpr> <multiplicative_tail>
                        | ε


# -------------------- Nível 9: Potência --------------------
# MUDANÇA: Agora trabalha com <unaryExpr>
<powerExpr> ::= <unaryExpr> <power_tail>

<power_tail> ::= '**' <powerExpr>
               | ε


# -------------------- Nível 10: Menos Unário --------------------
# SOLUÇÃO: - unário está AQUI (em nível próprio, ABAIXO de aditivos)
# Agora - unário NÃO conflita com - binário!
<unaryExpr> ::= '-' <unaryExpr>
              | <postfixExpr>


# -------------------- Nível 11: Postfix --------------------
<postfixExpr> ::= <primary> <postfix_list>

<postfix_list> ::= '[' <expression> ']' <postfix_list>
                 | '(' <arg_list> ')' <postfix_list>
                 | ε


# -------------------- Nível 12: Primários --------------------
<primary> ::= IDENTIFIER
            | NUMBER
            | STRING
            | 'True'
            | 'False'
            | '(' <expression> ')'
            | '[' <expression_list> ']'


# -------------------- Listas --------------------
<arg_list> ::= <expression> <arg_rest>
             | ε

<arg_rest> ::= ',' <expression> <arg_rest>
             | ε

<expression_list> ::= <expression> <expr_rest>
                    | ε

<expr_rest> ::= ',' <expression> <expr_rest>
              | ε


# ============================================================
# TERMINAIS
# ============================================================
# IDENTIFIER: [a-zA-Z_][a-zA-Z0-9_]*
# NUMBER: [0-9]+ ('.' [0-9]+)?
# STRING: '"' ... '"' | '\'' ... '\''


# ============================================================
# HIERARQUIA FINAL (do menor para maior precedência):
# ============================================================
#
#  0. Assignment        =                    (direita)
#  1. OR lógico         or                   (esquerda)
#  2. AND lógico        and                  (esquerda)
#  3. NOT lógico        not                  (unário, direita)
#  4. OR bitwise        |                    (esquerda)
#  5. AND bitwise       &                    (esquerda)
#  6. Comparação        ==, !=, <, >, <=, >= (não associa)
#  7. Aditivos          +, - (binário)       (esquerda)
#  8. Multiplicativos   *, /, %              (esquerda)
#  9. Potência          **                   (direita)
# 10. Unário            - (unário)           (direita)
# 11. Postfix           [], ()               (esquerda)
# 12. Primários         id, num, str, ()...
#
# ============================================================